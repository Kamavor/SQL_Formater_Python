if @use_service_provider_table=1 and object_id ( 'tempdb..#service_provider_filter' ) is null begin
	raiserror ( 'ошибка расщепления. не верно передан входной параметр фильтрации по услугам и поставщикам.', 15, 1 )
	return
	end
declare @sql nvarchar ( max ) , @s varchar ( max ) , @debug bit
declare @service_provider_filter table ( id_service int, id_provider int )
if @use_service_provider_table=1 and object_id ( 'tempdb..#service_provider_filter' ) is not null begin
	set @sql = 'select id_service, id_provider from #service_provider_filter'
	insert @service_provider_filter ( id_service, id_provider )
		exec ( @sql )
	end
create table #r ( checked bit, id_service int, service varchar ( 100 ) , sumbalance money, sumfact money, summ money, fine money, sumpay money, sumfine money, past_prov int, summ_show money )
if @debug = 1
	set @debugmaintables = 1
set @sum_pay = coalesce ( @sum_pay, 0 )
set @sum_fine = coalesce ( @sum_fine, 0 )
if @period is null
	select @period = dbo.work_period ( )
